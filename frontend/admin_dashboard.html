<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ExxamPortal Admin Console</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f9fb;
        }

        /* Custom gradient button effect */
        .btn-gradient-blue {
            background-image: linear-gradient(to right, #4F46E5, #3B82F6, #1E90FF);
            transition: all 0.3s ease;
        }

        .btn-gradient-blue:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        /* Modal transition effects */
        .modal {
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .modal.hidden {
            opacity: 0;
            transform: scale(0.95);
            pointer-events: none;
        }

        /* Custom styles for the visual design */
        .card-shadow {
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        .bg-card-blue {
            background-color: #EEF4FF;
        }

        .bg-card-green {
            background-color: #E6FFFA;
        }

        .bg-card-purple {
            background-color: #F3E8FF;
        }

        .bg-card-orange {
            background-color: #FFF5EE;
        }

        /* Exam card hover effect */
        .exam-card {
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .exam-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.1);
        }

        /* Badge styling */
        .badge {
            font-weight: 500;
            padding: 2px 8px;
            border-radius: 9999px;
            text-transform: uppercase;
            font-size: 0.75rem;
        }

        .badge-active {
            color: #10B981;
            background-color: #D1FAE5;
        }

        .badge-draft {
            color: #8B5CF6;
            background-color: #EDE9FE;
        }

        .badge-completed {
            color: #6B7280;
            background-color: #F3F4F6;
        }

        /* This is the new CSS rule that was missing */
        .badge-archived {
            color: #9CA3AF;
            background-color: #E5E7EB;
        }

        .badge-scheduled {
            color: #F97316;
            background-color: #FFEDD5;
        }

        .badge-advanced {
            color: #EF4444;
            background-color: #FEE2E2;
        }

        .badge-intermediate {
            color: #F97316;
            background-color: #FFEDD5;
        }

        .badge-beginner {
            color: #3B82F6;
            background-color: #DBEAFE;
        }

        /* Status dot for activity feed */
        .status-dot {
            height: 8px;
            width: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        /* The hidden class now just sets display: none; to hide the elements */
        .hidden {
            display: none;
        }
        .flex {
            display: flex;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="bg-blue-900 -md py-4 px-6 flex flex-col sm:flex-row justify-between items-center   sticky top-0 z-10">
        <div class="flex items-center space-x-3 mb-4 sm:mb-0">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24"
                stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round"
                    d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <h1 class="text-xl  text-white">ExamPortal Admin Console</h1>
        </div>
        <div class="flex flex-wrap items-center justify-center sm:justify-end space-x-2 sm:space-x-4">
            <span class="flex items-center text-sm text-green-600 font-medium">
                <span class="h-2 w-2 bg-green-500 rounded-full mr-1.5"></span>
                System Operational
            </span>
            <button id="create-exam-btn"
                class="flex items-center py-2 px-4 rounded-md text-white btn-gradient-blue text-sm font-medium">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                Create Exam
            </button>
            <button id="sign-out-btn"
                class="flex items-center py-2 px-4 rounded-md text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors text-sm font-medium">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" fill="none" viewBox="0 0 24 24"
                    stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round"
                        d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1m0-10V5m0 5h6m-6-6H5" />
                </svg>
                Signn Out
            </button>
        </div>
    </header>
    <main class="container mx-auto p-6 md:p-8 grid grid-cols-1 lg:grid-cols-4 gap-6">
        <div class="lg:col-span-3">
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
                <div class="mb-4 md:mb-0">
                    <h2 class="text-3xl font-semibold text-gray-800">Dashboard Overview</h2>
                    <p class="text-gray-500">Comprehensive exam management and student progress monitoring</p>
                </div>
                <p id="last-updated" class="text-sm text-gray-500 whitespace-nowrap">Last updated: Loading...</p>
            </div>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="dashboard-cards-container">
                <div class="bg-card-blue p-6 rounded-xl card-shadow border border-gray-200 flex flex-col items-start">
                    <div class="flex items-center justify-between w-full mb-2">
                        <h3 class="text-sm font-medium text-gray-700">Total Examinations</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    <p id="total-exams" class="text-4xl font-bold text-gray-900">0</p>
                    <div class="text-sm text-gray-600 mt-2">
                        <span id="new-exams-month" class="text-blue-500">+0 created this month</span><br>
                        <span id="total-subjects">0 subjects covered</span>
                    </div>
                </div>
                <div class="bg-card-green p-6 rounded-xl card-shadow border border-gray-200 flex flex-col items-start">
                    <div class="flex items-center justify-between w-full mb-2">
                        <h3 class="text-sm font-medium text-gray-700">Active Examinations</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
                        </svg>
                    </div>
                    <p id="active-exams" class="text-4xl font-bold text-gray-900">0</p>
                    <div class="text-sm text-gray-600 mt-2">
                        <p>Currently in progress</p>
                        <p id="completion-rate">0% completion rate</p>
                    </div>
                </div>
                <div class="bg-card-purple p-6 rounded-xl card-shadow border border-gray-200 flex flex-col items-start">
                    <div class="flex items-center justify-between w-full mb-2">
                        <h3 class="text-sm font-medium text-gray-700">Enrolled Students</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h-4m-4 0H7m0 0H5a2 2 0 01-2-2v-4a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2h-2" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 11V8a4 4 0 00-8 0v3m8 0v3a4 4 0 008 0v-3m-8 0a4 4 0 00-4 4v3" />
                        </svg>
                    </div>
                    <p id="total-students" class="text-4xl font-bold text-gray-900">0</p>
                    <div class="text-sm text-gray-600 mt-2">
                        <p>Across all examinations</p>
                        <p id="avg-students-per-exam">Average: 0 per exam</p>
                    </div>
                </div>
                <div class="bg-card-orange p-6 rounded-xl card-shadow border border-gray-200 flex flex-col items-start">
                    <div class="flex items-center justify-between w-full mb-2">
                        <h3 class="text-sm font-medium text-gray-700">Question Bank</h3>
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 19.5 15.75 15M8.25 9L12 4.5 15.75 9" />
                        </svg>
                    </div>
                    <p id="total-questions" class="text-4xl font-bold text-gray-900">0</p>
                    <div class="text-sm text-gray-600 mt-2">
                        <p>Total questions available</p>
                        <p id="avg-questions-per-exam">Avg: 0 per exam</p>
                    </div>
                </div>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <div class="flex flex-col sm:flex-row items-center justify-between mb-6 space-y-4 sm:space-y-0 sm:space-x-4">
                    <input type="text" id="search-input"
                        placeholder="Search examinations by title, subject, or ID..."
                        class="w-full sm:flex-1 px-4 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500">
                    <div class="flex items-center space-x-2 w-full sm:w-auto">
                        <select id="status-filter" class="px-4 py-2 border border-gray-300 rounded-md w-full sm:w-auto"name ="status">
                            <option value="all">All Status</option>
                            <option value="Active">Active</option>
                            <option value="Draft">Draft</option>
                            <option value="Completed">Completed</option>
                            <option value="Scheduled">Scheduled</option>
                            <option value="Archived">Archived</option>
                        </select>
                        <select id="subject-filter" class="px-4 py-2 border border-gray-300 rounded-md w-full sm:w-auto">
                            <option value="all">All Subjects</option>
                            <option value="Mathematics">Mathematics</option>
                            <option value="Physics">Physics</option>
                            <option value="Chemistry">Chemistry</option>
                            <option value="Biology">Biology</option>
                        </select>
                    </div>
                </div>
                <div class="space-y-4" id="exams-list">
                    <div id="loading-spinner" class="flex justify-center items-center py-12">
                        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"></div>
                    </div>
                </div>
            </div>
        </div>
        <aside class="space-y-6">
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h3 class="flex items-center text-lg font-semibold text-gray-800 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-yellow-500 mr-2" viewBox="0 0 20 20"
                        fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M8.257 3.322a1.5 1.5 0 012.486 0l5.526 8.527a1.5 1.5 0 01-1.243 2.151h-11.05a1.5 1.5 0 01-1.243-2.151L8.257 3.322z"
                            clip-rule="evenodd" />
                    </svg>
                    System Alerts
                </h3>
                <ul class="space-y-3 text-sm" id="alerts-list">
                    <li class="p-3 bg-gray-100 rounded-lg text-gray-700">Server maintenance scheduled for tonight at 2:00 AM</li>
                    <li class="p-3 bg-gray-100 rounded-lg text-gray-700">New analytics dashboard features available</li>
                    <li class="p-3 bg-green-100 rounded-lg text-gray-700">Database backup completed successfully</li>
                </ul>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h3 class="flex items-center text-lg font-semibold text-gray-800 mb-4">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600 mr-2" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m-6-10a9 9 0 100 18 9 9 0 000-18z" />
                    </svg>
                    Recent Activity
                </h3>
                <ul class="space-y-4 text-sm text-gray-700" id="activity-list">
                    <li class="flex items-start space-x-3">
                        <span class="mt-1 status-dot bg-green-500 flex-shrink-0"></span>
                        <p>Student ST2024045 completed Physics Midterm <br><span class="text-xs text-gray-400">2 minutes ago</span></p>
                    </li>
                    <li class="flex items-start space-x-3">
                        <span class="mt-1 status-dot bg-blue-500 flex-shrink-0"></span>
                        <p>New question added to Mathematics Final <br><span class="text-xs text-gray-400">15 minutes ago</span></p>
                    </li>
                    <li class="flex items-start space-x-3">
                        <span class="mt-1 status-dot bg-purple-500 flex-shrink-0"></span>
                        <p>Chemistry Lab Evaluation results published <br><span class="text-xs text-gray-400">1 hour ago</span></p>
                    </li>
                    <li class="flex items-start space-x-3">
                        <span class="mt-1 status-dot bg-red-500 flex-shrink-0"></span>
                        <p>5 students enrolled in Biology Quiz <br><span class="text-xs text-gray-400">2 hours ago</span></p>
                    </li>
                </ul>
            </div>
            <div class="bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Quick Actions</h3>
                <div class="grid gap-4">
                  <button id="createExamBtn" class="py-3 px-4 rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors font-medium flex items-center justify-center space-x-2">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
        <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
    </svg>
    <span>Create New Examination</span>
</button>
                    <button class="py-3 px-4 rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors font-medium flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M9 19V6l12-3v16H9zm0 0l12-3m-6-4h4m-4 4h4" />
                        </svg>
                        <span>Generate Report</span>
                    </button>
                    <button class="py-3 px-4 rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors font-medium flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M17 20h-4m-4 0H7m0 0H5a2 2 0 01-2-2v-4a2 2 0 012-2h14a2 2 0 012 2v4a2 2 0 01-2 2h-2" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M12 11V8a4 4 0 00-8 0v3m8 0v3a4 4 0 008 0v-3m-8 0a4 4 0 00-4 4v3" />
                        </svg>
                        <span>Manage Students</span>
                    </button>
                    <button class="py-3 px-4 rounded-md text-gray-700 bg-gray-100 hover:bg-gray-200 transition-colors font-medium flex items-center justify-center space-x-2">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                            <path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37a1.724 1.724 0 002.572-1.065z" />
                            <path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" />
                        </svg>
                        <span>System Settings</span>
                    </button>
                </div>
            </div>
        </aside>
    </main>
    <div id="create-exam-modal"
        class="modal hidden fixed inset-0 bg-gray-900 bg-opacity-50 flex items-center justify-center p-4 z-50">
        <div class="bg-white rounded-xl shadow-2xl p-6 w-full max-w-lg relative">
            <h3 class="text-xl font-semibold text-gray-800 mb-4">Create New Examination</h3>
            <form id="create-exam-form" class="space-y-4">
                <div>
                    <label for="exam-title" class="block text-sm font-medium text-gray-700">Exam Title</label>
                    <input type="text" id="exam-title" name="title" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                </div>
                <div>
                    <label for="exam-subject" class="block text-sm font-medium text-gray-700">Subject</label>
                    <select id="exam-subject" name="subject" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="">Select Subject</option>
                        <option value="Mathematics">Mathematics</option>
                        <option value="Physics">Physics</option>
                        <option value="Chemistry">Chemistry</option>
                        <option value="Biology">Biology</option>
                    </select>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label for="exam-duration" class="block text-sm font-medium text-gray-700">Duration (mins)</label>
                        <input type="number" id="exam-duration" name="duration" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                    <div>
                        <label for="exam-questions" class="block text-sm font-medium text-gray-700">Number of Questions</label>
                        <input type="number" id="exam-questions" name="questions" required
                            class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                    </div>
                </div>
                <div>
                    <label for="exam-level" class="block text-sm font-medium text-gray-700">Difficulty Level</label>
                    <select id="exam-level" name="level" required
                        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500">
                        <option value="Beginner">Beginner</option>
                        <option value="Intermediate">Intermediate</option>
                        <option value="Advanced">Advanced</option>
                    </select>
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" id="cancel-create"
                        class="py-2 px-4 rounded-md text-gray-700 bg-gray-200 hover:bg-gray-300 transition-colors">Cancel</button>
                    <button type="submit"
                        class="py-2 px-4 rounded-md text-white btn-gradient-blue focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">Create</button>
                </div>
            </form>
        </div>
    </div>
   <script>
    document.addEventListener('DOMContentLoaded', () => {
        // --- Element References ---
        const searchInput = document.getElementById('search-input');
        const statusFilter = document.getElementById('status-filter');
        const subjectFilter = document.getElementById('subject-filter');
        const examsListEl = document.getElementById('exams-list');
        const createExamModal = document.getElementById('create-exam-modal');
        const createExamBtnHeader = document.getElementById('create-exam-btn');
        const createExamBtnQuickActions = document.getElementById('createExamBtn');
        const createExamForm = document.getElementById('create-exam-form');
        const cancelCreateBtn = document.getElementById('cancel-create');
        const signOutBtn = document.getElementById('sign-out-btn');
        const totalExamsEl = document.getElementById('total-exams');
        const activeExamsEl = document.getElementById('active-exams');
        const totalStudentsEl = document.getElementById('total-students');
        const totalQuestionsEl = document.getElementById('total-questions');
        const loadingSpinner = document.getElementById('loading-spinner');
        const newExamsMonthEl = document.getElementById('new-exams-month');
        const totalSubjectsEl = document.getElementById('total-subjects');
        const completionRateEl = document.getElementById('completion-rate');
        const avgStudentsPerExamEl = document.getElementById('avg-students-per-exam');
        const avgQuestionsPerExamEl = document.getElementById('avg-questions-per-exam');
        const alertsListEl = document.getElementById('alerts-list');
        const activityListEl = document.getElementById('activity-list');
        const lastUpdatedEl = document.getElementById('last-updated');

        let allExams = [];
        
        // Replace this with your actual backend API URL
        const API_BASE_URL = 'http://localhost:3000/api';

        // --- Corrected createExamCard() function ---
     function createExamCard(exam) {
    const statusBadgeClasses = {
        'Active': 'badge badge-active',
        'Draft': 'badge badge-draft',
        'Completed': 'badge badge-completed',
        'Scheduled': 'badge badge-scheduled',
        'Archived': 'badge badge-archived'
    };
    const levelBadgeClasses = {
        'Advanced': 'badge badge-advanced',
        'Intermediate': 'badge badge-intermediate',
        'Beginner': 'badge badge-beginner'
    };

    // Use a default status if exam.status is undefined
    const examStatus = exam.status ;
    const statusText = examStatus;
    const statusClass = statusBadgeClasses[examStatus] || 'badge badge-default';

    const card = document.createElement('div');
    card.className = 'bg-gray-50 p-6 rounded-xl border border-gray-200 shadow-sm flex flex-col md:flex-row justify-between items-start md:items-center exam-card';
    card.setAttribute('data-title', exam.title);
    card.setAttribute('data-subject', exam.subject);
    card.setAttribute('data-status', examStatus); // Use the new variable here

    card.innerHTML = `
        <div class="flex-1 md:pr-4">
            <div class="flex flex-wrap items-center space-x-2 mb-2">
                <h4 class="text-lg font-semibold text-gray-800">${exam.title}</h4>
                <span class="${statusClass}">${statusText}</span>
                ${exam.level ? `<span class="${levelBadgeClasses[exam.level]}">${exam.level}</span>` : ''}
            </div>
            <div class="grid grid-cols-2 sm:grid-cols-4 gap-2 text-sm text-gray-600 mb-4 md:mb-0">
                <p><span class="font-semibold">Subject:</span> ${exam.subject}</p>
                <p><span class="font-semibold">Duration:</span> ${exam.duration} mins</p>
                <p><span class="font-semibold">Questions:</span> ${exam.questions || 'N/A'}</p>
                <p><span class="font-semibold">Enrolled:</span> ${exam.enrolledStudents || 'N/A'} students</p>
                <p><span class="font-semibold">Created:</span> ${new Date(exam.createdAt).toLocaleDateString()}</p>
                <p><span class="font-semibold">Pass Rate:</span> ${exam.passRate || 'N/A'}%</p>
                <p><span class="font-semibold">Avg Score:</span> ${exam.avgScore || 'N/A'}%</p>
                <p><span class="font-semibold">Completions:</span> ${exam.completions || 'N/A'}/${exam.enrolledStudents || 'N/A'}</p>
            </div>
        </div>
        <div class="flex-shrink-0 flex items-center space-x-2 mt-4 md:mt-0">
            <button class="py-2 px-4 rounded-md bg-blue-500 text-white hover:bg-blue-600 transition-colors manage-questions-btn" data-exam-id="${exam._id}">Manage Questions</button>
            <button class="py-2 px-4 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition-colors view-analytics-btn" data-exam-id="${exam._id}">View Analytics</button>
            ${examStatus !== 'Archived' ? `<button class="py-2 px-4 rounded-md bg-red-100 text-red-700 hover:bg-red-200 transition-colors archive-exam-btn" data-exam-id="${exam._id}">Archive Exam</button>` : ''}
        </div>
    `;
    return card;
}
        // --- Rest of your existing functions (unchanged) ---
        function createActivityItem(activity) {
            const dotColor = { 'Student': 'bg-green-500', 'New question': 'bg-blue-500', 'results published': 'bg-purple-500', 'students enrolled': 'bg-red-500', 'Application': 'bg-blue-500' };
            const dotClass = dotColor[Object.keys(dotColor).find(key => activity.message.includes(key))] || 'bg-gray-400';
            const timeAgo = (new Date() - new Date(activity.timestamp)) / 1000;
            const timeString = formatTimeAgo(timeAgo);
            const li = document.createElement('li');
            li.className = 'flex items-start space-x-3';
            li.innerHTML = `<span class="mt-1 status-dot ${dotClass} flex-shrink-0"></span><p>${activity.message}<br><span class="text-xs text-gray-400">${timeString}</span></p>`;
            return li;
        }

        function formatTimeAgo(seconds) {
            if (seconds < 60) return `${Math.floor(seconds)} seconds ago`;
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes} minute${minutes > 1 ? 's' : ''} ago`;
            const hours = Math.floor(minutes / 60);
            if (hours < 24) return `${hours} hour${hours > 1 ? 's' : ''} ago`;
            const days = Math.floor(hours / 24);
            return `${days} day${days > 1 ? 's' : ''} ago`;
        }

      function renderExams() {
    if (!examsListEl) {
        console.error("Exams list element not found. Cannot render exams.");
        return;
    }
    
    // ðŸ’¡ Add this critical line to clear the container
    examsListEl.innerHTML = '';
    
    const searchTerm = searchInput.value.toLowerCase();
    const statusValue = statusFilter.value;
    const subjectValue = subjectFilter.value;

    const filteredExams = allExams.filter(exam => {
        const matchesSearch = exam.title.toLowerCase().includes(searchTerm) ||
                              (exam.subject && exam.subject.toLowerCase().includes(searchTerm));
        const matchesStatus = statusValue === 'all' || exam.status === statusValue;
        const matchesSubject = subjectValue === 'all' || exam.subject === subjectValue;

        return matchesSearch && matchesStatus && matchesSubject;
    });

    if (filteredExams.length > 0) {
        filteredExams.forEach(exam => {
            examsListEl.appendChild(createExamCard(exam));
        });
    } else {
        examsListEl.innerHTML = '<p class="text-center text-gray-500">No examinations found matching your criteria.</p>';
    }
}

        function renderActivity(activity) {
            const sortedActivity = activity.sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            activityListEl.innerHTML = '';
            sortedActivity.forEach(item => {
                activityListEl.appendChild(createActivityItem(item));
            });
        }

        async function fetchData() {
            loadingSpinner.classList.remove('hidden');
            try {
                const examsResponse = await fetch(`${API_BASE_URL}/exams`);
                if (examsResponse.ok) {
                    allExams = await examsResponse.json();
                    renderExams();
                }

                const totalExams = allExams.length;
                const activeExams = allExams.filter(exam => exam.status === 'Active').length;
                const uniqueSubjects = new Set(allExams.map(exam => exam.subject)).size;
                const totalStudents = allExams.reduce((sum, exam) => sum + (exam.enrolledStudents || 0), 0);
                const totalQuestions = allExams.reduce((sum, exam) => sum + (exam.questions || 0), 0);
                
                const activeExam = allExams.find(exam => exam.status === 'Active');
                const completionRate = activeExam && activeExam.enrolledStudents > 0 ? ((activeExam.completions || 0) / activeExam.enrolledStudents * 100).toFixed(0) : '0';
                
                const avgStudents = totalExams > 0 ? (totalStudents / totalExams).toFixed(0) : '0';
                const avgQuestions = totalExams > 0 ? (totalQuestions / totalExams).toFixed(0) : '0';

                totalExamsEl.textContent = totalExams;
                newExamsMonthEl.textContent = `+0 created this month`; 
                totalSubjectsEl.textContent = `${uniqueSubjects} subjects covered`;
                activeExamsEl.textContent = activeExams;
                completionRateEl.textContent = `${completionRate}% completion rate`;
                totalStudentsEl.textContent = totalStudents;
                avgStudentsPerExamEl.textContent = `Average: ${avgStudents} per exam`;
                totalQuestionsEl.textContent = totalQuestions;
                avgQuestionsPerExamEl.textContent = `Avg: ${avgQuestions} per exam`;
                
                lastUpdatedEl.textContent = `Last updated: ${new Date().toLocaleString('en-US', { dateStyle: 'short', timeStyle: 'short' })}`;

                const activityResponse = await fetch(`${API_BASE_URL}/activity`);
                if (activityResponse.ok) {
                    const activity = await activityResponse.json();
                    renderActivity(activity);
                }

            } catch (error) {
                console.error("Error fetching data:", error);
                examsListEl.innerHTML = '<p class="text-center text-red-500">Failed to load data. Please check your backend connection.</p>';
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }

        function populateStaticAlerts() {
            const staticAlerts = [
                { message: 'Server maintenance scheduled for tonight at 2:00 AM' },
                { message: 'New analytics dashboard features available' },
                { message: 'Database backup completed successfully', status: 'success' }
            ];
            alertsListEl.innerHTML = '';
            staticAlerts.forEach(alert => {
                const li = document.createElement('li');
                const bgColor = alert.status === 'success' ? 'bg-green-100' : 'bg-gray-100';
                li.className = `p-3 ${bgColor} rounded-lg text-gray-700`;
                li.textContent = alert.message;
                alertsListEl.appendChild(li);
            });
        }

        populateStaticAlerts();
        fetchData();

        // --- Event Listeners ---
        if (searchInput) searchInput.addEventListener('input', renderExams);
        if (statusFilter) statusFilter.addEventListener('change', renderExams);
        if (subjectFilter) subjectFilter.addEventListener('change', renderExams);
        
        if (createExamBtnHeader) {
            createExamBtnHeader.addEventListener('click', function() {
                window.location.href = 'create_exam.html';
            });
        }

        if (createExamBtnQuickActions) {
            createExamBtnQuickActions.addEventListener('click', () => {
                if (createExamModal) createExamModal.classList.remove('hidden');
            });
        }
        
        if (cancelCreateBtn) cancelCreateBtn.addEventListener('click', () => { createExamModal.classList.add('hidden'); });

        if (createExamForm) {
            createExamForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const formData = new FormData(createExamForm);
                const newExam = {
                    title: formData.get('title'),
                    subject: formData.get('subject'),
                    duration: parseInt(formData.get('duration')),
                    questions: parseInt(formData.get('questions')),
                    level: formData.get('level'),
                   status: formData.get('status'),

                    createdAt: new Date().toISOString()
                };

                try {
                    const response = await fetch(`${API_BASE_URL}/exams`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(newExam)
                    });

                    if (response.ok) {
                        const result = await response.json();
                        console.log('Exam created successfully:', result);
                        createExamModal.classList.add('hidden');
                        createExamForm.reset();
                        alert("Exam created successfully!");
                        fetchData();
                    } else {
                        throw new Error(`Server responded with status: ${response.status}`);
                    }
                } catch (error) {
                    console.error("Error creating exam:", error);
                    alert("Failed to create exam. Check console for details.");
                }
            });
        }

      examsListEl.addEventListener('click', async (event) => {
    const manageBtn = event.target.closest('.manage-questions-btn');
    const analyticsBtn = event.target.closest('.view-analytics-btn');
    const archiveBtn = event.target.closest('.archive-exam-btn');

    if (manageBtn) {
        const examId = manageBtn.dataset.examId;
        window.location.href = `add_questions.html?examId=${examId}`;
    }

    if (analyticsBtn) {
        const examId = analyticsBtn.dataset.examId;
        window.location.href = `view_analytics.html?examId=${examId}`;
    }

    if (archiveBtn) {
        const examId = archiveBtn.dataset.examId;
        if (confirm("Are you sure you want to archive this exam? This action cannot be undone.")) {
            try {
                const response = await fetch(`${API_BASE_URL}/exams/${examId}`, {
                    method: 'PATCH',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ status: 'Archived' })
                });

                if (response.ok) {
                    alert("Exam successfully archived.");
                    // ðŸ’¡ CRITICAL FIX: Re-fetch and re-render all exams
                    await fetchData();
                } else {
                    throw new Error(`Server responded with status: ${response.status}`);
                }
            } catch (error) {
                console.error("Error archiving exam:", error);
                alert("Failed to archive exam. Check console for details.");
            }
        }
    }
});

        if (signOutBtn) {
            signOutBtn.addEventListener('click', async () => {
                // You'll need to implement your sign-out API endpoint here
                alert("Sign Out functionality would be handled by your backend API.");
                window.location.href = 'admin_login.html';
            });
        }
    });
     document.addEventListener('DOMContentLoaded', () => {
            const createExamForm = document.getElementById('create-exam-form');
            const messageBox = document.getElementById('message-box');
            const logoutBtn = document.getElementById('logout-btn');

            const API_EXAM_URL = 'http://localhost:3000/api/exams';

            function showMessage(message, type) {
                messageBox.textContent = message;
                messageBox.classList.remove('hidden', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');
                if (type === 'success') {
                    messageBox.classList.add('bg-green-100', 'text-green-700');
                } else if (type === 'error') {
                    messageBox.classList.add('bg-red-100', 'text-red-700');
                }
            }

            createExamForm.addEventListener('submit', async (e) => {
                e.preventDefault();
                
                const title = document.getElementById('exam-title').value;
                const subject = document.getElementById('exam-subject').value;
                const difficulty = document.getElementById('exam-difficulty').value;
                const duration = parseInt(document.getElementById('exam-duration').value, 10);
                const questionsJson = document.getElementById('exam-questions').value;

                let questions = [];
                try {
                    questions = JSON.parse(questionsJson);
                } catch (error) {
                    showMessage('Invalid JSON for questions. Please check the format.', 'error');
                    return;
                }

                // Append 'published' flag to each question
                const questionsWithStatus = questions.map(q => ({ ...q, published: true }));

                const examData = {
                    title,
                    subject,
                    difficulty,
                    duration,
                    questions: questionsWithStatus,
                    published: true // Mark exam as published
                };

                try {
                    const response = await fetch(API_EXAM_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(examData)
                    });

                    const result = await response.json();

                    if (response.ok) {
                        showMessage('Exam published successfully! It is now available to students.', 'success');
                        createExamForm.reset();
                    } else {
                        showMessage(result.message || 'Failed to publish exam.', 'error');
                    }
                } catch (error) {
                    console.error('Error:', error);
                    showMessage('An error occurred. Please check the server.', 'error');
                }
            });

            // Basic logout functionality for demonstration
            logoutBtn.addEventListener('click', () => {
                // In a real application, you would handle token invalidation here
                window.location.href = 'student_login.html';
            });
        });
</script>
</body>
</html>
<!-- see i will give u code in two part later you merge it ,firstly i will give you first part then wait until i provide you secon part of the code then combine then and solve problem -->
 <!-- do not chng any old thing ,update it and give whole correcte code -->